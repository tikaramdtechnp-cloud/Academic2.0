using System;
using System.Collections.Generic;
using System.Linq;
using System.Runtime.InteropServices;
using System.Web;
using System.Web.Mvc;
using Dynamic.BusinessEntity.Global;
namespace PivotalERP.Areas.Inventory.Controllers
{
    public class ReportingController : PivotalERP.Controllers.BaseController
    {

        public ActionResult SalesMaterializedView()
        {
            return View();
        }


        [HttpPost]
        public JsonNetResultWithEnum GetSalesMaterializedView(DateTime? dateFrom, DateTime? dateTo, bool IsReturn)
        {
            Dynamic.ReportEntity.Inventory.SalesMaterializedViewCollections dataColl = new Dynamic.ReportEntity.Inventory.SalesMaterializedViewCollections();
            try
            {
                dataColl = new Dynamic.Reporting.Inventory.SalesMaterilizedView(User.HostName, User.DBName).getSalesMaterializedView(User.UserId, dateFrom.Value, dateTo.Value, IsReturn);



                return new JsonNetResultWithEnum() { Data = dataColl, TotalCount = dataColl.Count, IsSuccess = dataColl.IsSuccess, ResponseMSG = dataColl.ResponseMSG };
            }
            catch (Exception ee)
            {
                dataColl.IsSuccess = false;
                dataColl.ResponseMSG = ee.Message;

            }
            return new JsonNetResultWithEnum() { Data = null, TotalCount = 0, IsSuccess = dataColl.IsSuccess, ResponseMSG = dataColl.ResponseMSG };
        }

        public ActionResult SalesInvoiceDetails()
        {
            ViewBag.Title = "SalesInvoiceDetails";
            ViewBag.EntityId = Convert.ToInt32(Dynamic.BusinessEntity.Global.RptFormsEntity.SalesInvoiceDetails);
            return View();
        }
        [HttpPost]
        public JsonNetResultWithEnum GetSalesInvoiceDetails(DateTime? dateFrom, DateTime? dateTo)
        {
            Dynamic.ReportEntity.Inventory.SalesInvoiceDetailsCollections dataColl = new Dynamic.ReportEntity.Inventory.SalesInvoiceDetailsCollections();
            try
            {


                dataColl = new Dynamic.Reporting.Inventory.SalesRegister(User.HostName, User.DBName).getSalesInvoiceDetails(User.UserId, dateFrom.Value, dateTo.Value);
                return new JsonNetResultWithEnum() { Data = dataColl, TotalCount = dataColl.Count, IsSuccess = dataColl.IsSuccess, ResponseMSG = dataColl.ResponseMSG };
            }
            catch (Exception ee)
            {
                dataColl.IsSuccess = false;
                dataColl.ResponseMSG = ee.Message;

            }
            return new JsonNetResultWithEnum() { Data = null, TotalCount = 0, IsSuccess = dataColl.IsSuccess, ResponseMSG = dataColl.ResponseMSG };
        }

        public ActionResult ProductGroupDetails()
        {
            return View();
        }

        
        public ActionResult CRLimitExpiredParty()
        {
            return View();
        }

        [HttpPost]
        public JsonNetResult GetCRLimitExpiredParty(DateTime? dateFrom,DateTime? dateTo)
        {
            Dynamic.ReportEntity.Inventory.CreditLimitExpiredCollections dataColl = new Dynamic.ReportEntity.Inventory.CreditLimitExpiredCollections();
            try
            {
                dataColl = new Dynamic.Reporting.Inventory.PartyAgeingReport(User.HostName, User.DBName).getCreditLimitExpiredPartyList(User.UserId, dateFrom, dateTo);

                return new JsonNetResult() { Data = dataColl, TotalCount = dataColl.Count, IsSuccess = dataColl.IsSuccess, ResponseMSG = dataColl.ResponseMSG };
            }
            catch (Exception ee)
            {
                dataColl.IsSuccess = false;
                dataColl.ResponseMSG = ee.Message;

            }
            return new JsonNetResult() { Data = "", TotalCount = 0, IsSuccess = dataColl.IsSuccess, ResponseMSG = dataColl.ResponseMSG };
        }

        
        public ActionResult PendingPOSummary()
        {
            return View();
        }

        [HttpPost]
        public JsonNetResult GetPendingPOSummary(DateTime? dateFrom, DateTime? dateTo)
        {
            Dynamic.ReportEntity.Inventory.PendingPurchaseOrderSummaryCollections dataColl = new Dynamic.ReportEntity.Inventory.PendingPurchaseOrderSummaryCollections();
            try
            {
                dataColl = new Dynamic.Reporting.Inventory.PendingPurchaseOrder(User.HostName, User.DBName).getPendingPurchaseOrderSummary(User.UserId, dateFrom, dateTo);

                return new JsonNetResult() { Data = dataColl, TotalCount = dataColl.Count, IsSuccess = dataColl.IsSuccess, ResponseMSG = dataColl.ResponseMSG };
            }
            catch (Exception ee)
            {
                dataColl.IsSuccess = false;
                dataColl.ResponseMSG = ee.Message;

            }
            return new JsonNetResult() { Data = "", TotalCount = 0, IsSuccess = dataColl.IsSuccess, ResponseMSG = dataColl.ResponseMSG };
        }


        
        public ActionResult PendingSOSummary()
        {
            return View();
        }

        [HttpPost]
        public JsonNetResult GetPendingSOSummary(DateTime? dateFrom, DateTime? dateTo)
        {
            Dynamic.Dashboard.BE.PendingSalesOrderCollections dataColl = new Dynamic.Dashboard.BE.PendingSalesOrderCollections();
            try
            {
                dataColl = new Dynamic.Dashboard.DA.InventoryDB(User.HostName, User.DBName).getSalesDashBoardDetails21(User.UserId, dateFrom, dateTo);

                return new JsonNetResult() { Data = dataColl, TotalCount = dataColl.Count, IsSuccess = dataColl.IsSuccess, ResponseMSG = dataColl.ResponseMSG };
            }
            catch (Exception ee)
            {
                dataColl.IsSuccess = false;
                dataColl.ResponseMSG = ee.Message;

            }
            return new JsonNetResult() { Data = "", TotalCount = 0, IsSuccess = dataColl.IsSuccess, ResponseMSG = dataColl.ResponseMSG };
        }
        // GET: Inventory/Reporting
        public ActionResult Product()
        {
            ViewBag.Title = "Product List";
            ViewBag.EntityId = Convert.ToInt32(Dynamic.BusinessEntity.Global.RptFormsEntity.ListOfProduct);
            return View();
        }
        [HttpGet]
        public JsonNetResultWithEnum GetAllProduct()
        {
            Dynamic.BusinessEntity.Inventory.ProductCollections dataColl = new Dynamic.BusinessEntity.Inventory.ProductCollections();
            try
            {

                dataColl = new Dynamic.BusinessLogic.Inventory.Product(User.HostName, User.DBName).getAllAsList(User.UserId);
                return new JsonNetResultWithEnum() { Data = dataColl, TotalCount = dataColl.Count, IsSuccess = dataColl.IsSuccess, ResponseMSG = dataColl.ResponseMSG };
            }
            catch (Exception ee)
            {
                dataColl.IsSuccess = false;
                dataColl.ResponseMSG = ee.Message;

            }
            return new JsonNetResultWithEnum() { Data = null, TotalCount = 0, IsSuccess = dataColl.IsSuccess, ResponseMSG = dataColl.ResponseMSG };
        }
        public ActionResult Godown()
        {
            ViewBag.Title = "Godown";
            ViewBag.EntityId = Convert.ToInt32(Dynamic.BusinessEntity.Global.RptFormsEntity.ListOfGodown);
            return View();
        }

        [HttpGet]
        public JsonNetResultWithEnum GetAllGodown()
        {
            Dynamic.BusinessEntity.Inventory.GodownCollections dataColl = new Dynamic.BusinessEntity.Inventory.GodownCollections();
            try
            {

                dataColl = new Dynamic.BusinessLogic.Inventory.Godown(User.HostName, User.DBName).getAllAsList(User.UserId);
                return new JsonNetResultWithEnum() { Data = dataColl, TotalCount = dataColl.Count, IsSuccess = dataColl.IsSuccess, ResponseMSG = dataColl.ResponseMSG };
            }
            catch (Exception ee)
            {
                dataColl.IsSuccess = false;
                dataColl.ResponseMSG = ee.Message;

            }
            return new JsonNetResultWithEnum() { Data = null, TotalCount = 0, IsSuccess = dataColl.IsSuccess, ResponseMSG = dataColl.ResponseMSG };
        }

        public ActionResult ProductRateList()
        {
            ViewBag.Title = "Product Rate List";
            ViewBag.EntityId = Convert.ToInt32(Dynamic.BusinessEntity.Global.RptFormsEntity.CurrentProductRateList);
            return View();
        }
        [HttpGet]
        public JsonNetResultWithEnum GetAllProductRateList()
        {
            Dynamic.ReportEntity.Inventory.ProductRateListCollections dataColl = new Dynamic.ReportEntity.Inventory.ProductRateListCollections();
            try
            {
                int? totalRows = 0;
                dataColl = new Dynamic.Reporting.Inventory.Product(User.HostName, User.DBName).getProductRateList(User.UserId, User.BranchId,null,null,"","",out totalRows);
                return new JsonNetResultWithEnum() { Data = dataColl, TotalCount = dataColl.Count, IsSuccess = dataColl.IsSuccess, ResponseMSG = dataColl.ResponseMSG };
            }
            catch (Exception ee)
            {
                dataColl.IsSuccess = false;
                dataColl.ResponseMSG = ee.Message;

            }
            return new JsonNetResultWithEnum() { Data = null, TotalCount = 0, IsSuccess = dataColl.IsSuccess, ResponseMSG = dataColl.ResponseMSG };
        }
        public ActionResult PartyWiseProductRate()
        {
            ViewBag.Title = "Party Wise Product Rate";
            ViewBag.EntityId = Convert.ToInt32(Dynamic.BusinessEntity.Global.RptFormsEntity.PartyWiseProductRateList);
            return View();
        }
        [HttpGet]
        public JsonNetResultWithEnum GetAllPartywiseProductRate()
        {
            Dynamic.ReportEntity.Inventory.PartyWiseProductRateListCollections dataColl = new Dynamic.ReportEntity.Inventory.PartyWiseProductRateListCollections();
            try
            {

                dataColl = new Dynamic.Reporting.Inventory.PartyWiseProductRateList(User.HostName, User.DBName).getPartyWiseProductRateList(User.UserId);
                return new JsonNetResultWithEnum() { Data = dataColl, TotalCount = dataColl.Count, IsSuccess = dataColl.IsSuccess, ResponseMSG = dataColl.ResponseMSG };
            }
            catch (Exception ee)
            {
                dataColl.IsSuccess = false;
                dataColl.ResponseMSG = ee.Message;

            }
            return new JsonNetResultWithEnum() { Data = null, TotalCount = 0, IsSuccess = dataColl.IsSuccess, ResponseMSG = dataColl.ResponseMSG };
        }
        public ActionResult ProductAlternetUnitList()
        {
            ViewBag.Title = "Product Alternet Unit List";
            ViewBag.EntityId = Convert.ToInt32(Dynamic.BusinessEntity.Global.RptFormsEntity.ProductAlternetUnitList);
            return View();
        }
        [HttpGet]
        public JsonNetResultWithEnum GetAllProductAlternetUnitList()
        {
            Dynamic.ReportEntity.Inventory.ProductAlternetUnitCollections dataColl = new Dynamic.ReportEntity.Inventory.ProductAlternetUnitCollections();
            try
            {

                dataColl = new Dynamic.Reporting.Inventory.Product(User.HostName, User.DBName).getProductAlternetUnit(User.UserId, User.BranchId);
                return new JsonNetResultWithEnum() { Data = dataColl, TotalCount = dataColl.Count, IsSuccess = dataColl.IsSuccess, ResponseMSG = dataColl.ResponseMSG };
            }
            catch (Exception ee)
            {
                dataColl.IsSuccess = false;
                dataColl.ResponseMSG = ee.Message;

            }
            return new JsonNetResultWithEnum() { Data = null, TotalCount = 0, IsSuccess = dataColl.IsSuccess, ResponseMSG = dataColl.ResponseMSG };
        }
        public ActionResult PartyWiseProductList()
        {
            ViewBag.Title = "Party Wise Product List";
            ViewBag.EntityId = Convert.ToInt32(Dynamic.BusinessEntity.Global.RptFormsEntity.PartyWiseProductList);
            return View();
        }
        [HttpGet]
        public JsonNetResultWithEnum GetAllPartyWiseProductList()
        {
            Dynamic.ReportEntity.Inventory.PartyWiseProductListCollections dataColl = new Dynamic.ReportEntity.Inventory.PartyWiseProductListCollections();
            try
            {

                dataColl = new Dynamic.Reporting.Inventory.PartyWiseProductList(User.HostName, User.DBName).getPartyWiseProductList(User.UserId);
                return new JsonNetResultWithEnum() { Data = dataColl, TotalCount = dataColl.Count, IsSuccess = dataColl.IsSuccess, ResponseMSG = dataColl.ResponseMSG };
            }
            catch (Exception ee)
            {
                dataColl.IsSuccess = false;
                dataColl.ResponseMSG = ee.Message;

            }
            return new JsonNetResultWithEnum() { Data = null, TotalCount = 0, IsSuccess = dataColl.IsSuccess, ResponseMSG = dataColl.ResponseMSG };
        }

        
        public ActionResult PurchaseAnalysis()
        {
            return View();
        }
        public JsonNetResult GetPurchaseAnalysisProductWise(DateTime dateFrom, DateTime dateTo)
        {
            Dynamic.ReportEntity.Inventory.SalesAnalysisProductWiseCollections dataColl = new Dynamic.Reporting.Inventory.PurchaseAnalysis(User.HostName, User.DBName).getSalesAnalysisProductWise(User.UserId, dateFrom, dateTo);

            return new JsonNetResult() { Data = dataColl };
        }

        public JsonNetResult GetPurchaseAnalysisProducGrouptWise(DateTime dateFrom, DateTime dateTo)
        {
            Dynamic.ReportEntity.Inventory.SalesAnalysisProductWiseCollections dataColl = new Dynamic.Reporting.Inventory.PurchaseAnalysis(User.HostName, User.DBName).getSalesAnalysisProductGroupWise(User.UserId, dateFrom, dateTo);

            return new JsonNetResult() { Data = dataColl };
        }

        public JsonNetResult GetPurchaseAnalysisPartyWise(DateTime dateFrom, DateTime dateTo,string forRpt)
        {
            string procName = "sp_GetPurchaseAnalysisPartyWise";

            if(forRpt == "ProductWise")
                procName = "sp_GetPurchaseAnalysisPartyWise";
            else if (forRpt == "ProductGroupWise")
                procName = "sp_GetPurchaseAnalysisPartyWiseAndProductGroupWise";
            else if (forRpt == "ProductCategorieswise")
                procName = "sp_GetPurchaseAnalysisPartyWiseAndProductCategoryWise";
             

            Dynamic.ReportEntity.Inventory.SalesAnalysisPartyWiseCollections dataColl = new Dynamic.Reporting.Inventory.PurchaseAnalysisPartyWise(User.HostName, User.DBName).getPurchaseAnalysisPartWiseWise(User.UserId, dateFrom, dateTo,procName);

            return new JsonNetResult() { Data = dataColl };
        }


        [HttpPost]
        public JsonNetResult PrintPurchaseAnalysisProductWise()
        {
            var jsonData = Request["jsonData"];
            List<Dynamic.ReportEntity.Inventory.SalesAnalysisProductWise> paraData = DeserializeObject<List<Dynamic.ReportEntity.Inventory.SalesAnalysisProductWise>>(jsonData);
            ResponeValues resVal = new ResponeValues();
            try
            {
                var key = Guid.NewGuid().ToString().Replace("-", "");
                Session.Add(key, paraData);
                resVal.ResponseId = key;
                resVal.IsSuccess = true;
                return new JsonNetResult() { Data = resVal, TotalCount = 1, IsSuccess = true, ResponseMSG = GLOBALMSG.SUCCESS };
            }
            catch (Exception ee)
            {
                resVal.IsSuccess = false;
                resVal.ResponseMSG = ee.Message;

            }
            return new JsonNetResult() { Data = "", TotalCount = 0, IsSuccess = resVal.IsSuccess, ResponseMSG = resVal.ResponseMSG };
        }



        
        public ActionResult PurchaseRegister()
        {
            return View();
        }

        public JsonNetResultWithEnum GetPurchaseRegister(DateTime dateFrom, DateTime dateTo)
        {
            Dynamic.ReportEntity.Inventory.SalesRegisterCollections dataColl = new Dynamic.Reporting.Inventory.SalesRegister(User.HostName, User.DBName).getPurchaseRegister(User.UserId, dateFrom, dateTo);

            return new JsonNetResultWithEnum() { Data = dataColl };
        }

        
        public ActionResult PendingPurchaseOrder()
        {
            return View();
        }

        public JsonNetResultWithEnum GetPendingPurchaseOrder(DateTime dateFrom, DateTime dateTo,int ReportTypeId)
        {
            bool isPendingOnly = true;
            bool isClearOnly = false;

            switch (ReportTypeId)
            {
                case 1:
                    {
                        isPendingOnly = true;
                        isClearOnly = false;
                        break;
                    }
                case 2:
                    {
                        isPendingOnly = false;
                        isClearOnly = true;
                        break;
                    }
                case 3:
                    {
                        isPendingOnly = true;
                        isClearOnly = true;
                        break;
                    }
                default:
                    isPendingOnly = true;
                    break;
            }

            Dynamic.ReportEntity.Inventory.PendingSalesOrderDetailsCollections dataColl = new Dynamic.Reporting.Inventory.PendingPurchaseOrder(User.HostName, User.DBName).getPendingSalesDetails(User.UserId, dateFrom, dateTo, isPendingOnly, isClearOnly);

            return new JsonNetResultWithEnum() { Data = dataColl };
        }

        
        public ActionResult PendingReceiptNote()
        {
            return View();
        }
        public JsonNetResultWithEnum GetPendingReceiptNote(DateTime dateFrom, DateTime dateTo, int ReportTypeId)
        {
            bool isPendingOnly = true;
            bool isClearOnly = false;

            switch (ReportTypeId)
            {
                case 1:
                    {
                        isPendingOnly = true;
                        isClearOnly = false;
                        break;
                    }
                case 2:
                    {
                        isPendingOnly = false;
                        isClearOnly = true;
                        break;
                    }
                case 3:
                    {
                        isPendingOnly = true;
                        isClearOnly = true;
                        break;
                    }
                default:
                    isPendingOnly = true;
                    break;
            }

            Dynamic.ReportEntity.Inventory.PendingReceiptNoteDetailsCollections dataColl = new Dynamic.Reporting.Inventory.PendingReceiptNote(User.HostName, User.DBName).getPendingReceiptNoteDetails(User.UserId, dateFrom, dateTo, isPendingOnly, isClearOnly);

            return new JsonNetResultWithEnum() { Data = dataColl };
        }

        
        public ActionResult SalesAnalysis()
        {
            return View();
        }

        public JsonNetResult GetSalesAnalysisProductWise(DateTime dateFrom, DateTime dateTo)
        {
            Dynamic.ReportEntity.Inventory.SalesAnalysisProductWiseCollections dataColl = new Dynamic.Reporting.Inventory.SalesAnalysisProductWise(User.HostName, User.DBName).getSalesAnalysisProductWise(User.UserId, dateFrom, dateTo);

            return new JsonNetResult() { Data = dataColl };
        }

        public JsonNetResult GetSalesAnalysisProducGrouptWise(DateTime dateFrom, DateTime dateTo)
        {
            Dynamic.ReportEntity.Inventory.SalesAnalysisProductWiseCollections dataColl = new Dynamic.Reporting.Inventory.SalesAnalysisProductWise(User.HostName, User.DBName).getSalesAnalysisProductGroupWise(User.UserId, dateFrom, dateTo);

            return new JsonNetResult() { Data = dataColl };
        }

        public JsonNetResult GetSalesAnalysisPartyWise(DateTime dateFrom, DateTime dateTo, string forRpt)
        {
            string procName = "sp_GetSalesAnalysisPartyWise";

            if (forRpt == "ProductWise")
                procName = "sp_GetSalesAnalysisPartyWise";
            else if (forRpt == "ProductGroupWise")
                procName = "sp_GetSalesAnalysisPartyWiseAndProductGroupWise";
            else if (forRpt == "ProductCategorieswise")
                procName = "sp_GetSalesAnalysisPartyWiseAndProductCategoryWise";


            Dynamic.ReportEntity.Inventory.SalesAnalysisPartyWiseCollections dataColl = new Dynamic.Reporting.Inventory.SalesAnalysisPartyWise(User.HostName, User.DBName).getSalesAnalysisPartWiseWise(User.UserId, dateFrom, dateTo, procName);

            return new JsonNetResult() { Data = dataColl };
        }


        [HttpPost]
        public JsonNetResult PrintSalesAnalysisProductWise()
        {
            var jsonData = Request["jsonData"];
            List<Dynamic.ReportEntity.Inventory.SalesAnalysisProductWise> paraData = DeserializeObject<List<Dynamic.ReportEntity.Inventory.SalesAnalysisProductWise>>(jsonData);
            ResponeValues resVal = new ResponeValues();
            try
            {
                var key = Guid.NewGuid().ToString().Replace("-", "");
                Session.Add(key, paraData);
                resVal.ResponseId = key;
                resVal.IsSuccess = true;
                return new JsonNetResult() { Data = resVal, TotalCount = 1, IsSuccess = true, ResponseMSG = GLOBALMSG.SUCCESS };
            }
            catch (Exception ee)
            {
                resVal.IsSuccess = false;
                resVal.ResponseMSG = ee.Message;

            }
            return new JsonNetResult() { Data = "", TotalCount = 0, IsSuccess = resVal.IsSuccess, ResponseMSG = resVal.ResponseMSG };
        }


        
        public ActionResult SalesRegister()
        {
            return View();
        }
        public JsonNetResultWithEnum GetSalesRegister(DateTime dateFrom, DateTime dateTo)
        {
            Dynamic.ReportEntity.Inventory.SalesRegisterCollections dataColl = new Dynamic.Reporting.Inventory.SalesRegister(User.HostName, User.DBName).getSalesRegister(User.UserId, dateFrom, dateTo);

            return new JsonNetResultWithEnum() { Data = dataColl };
        }

        
        public ActionResult PendingSalesQuotation()
        {
            return View();
        }
        public JsonNetResultWithEnum GetPendingSalesQuotation(DateTime dateFrom, DateTime dateTo, int ReportTypeId)
        {
            bool isPendingOnly = true;
            bool isClearOnly = false;

            switch (ReportTypeId)
            {
                case 1:
                    {
                        isPendingOnly = true;
                        isClearOnly = false;
                        break;
                    }
                case 2:
                    {
                        isPendingOnly = false;
                        isClearOnly = true;
                        break;
                    }
                case 3:
                    {
                        isPendingOnly = true;
                        isClearOnly = true;
                        break;
                    }
                default:
                    isPendingOnly = true;
                    break;
            }

            Dynamic.ReportEntity.Inventory.PendingSalesOrderDetailsCollections dataColl = new Dynamic.Reporting.Inventory.PendingSalesOrderDetails(User.HostName, User.DBName).getPendingSalesQuotationDetails(User.UserId, dateFrom, dateTo, isPendingOnly, isClearOnly);

            return new JsonNetResultWithEnum() { Data = dataColl };
        }


        
        public ActionResult PendingSalesOrder()
        {
            return View();
        }

        public JsonNetResultWithEnum GetPendingSalesOrder(DateTime dateFrom, DateTime dateTo, int ReportTypeId)
        {
            bool isPendingOnly = true;
            bool isClearOnly = false;

            switch (ReportTypeId)
            {
                case 1:
                    {
                        isPendingOnly = true;
                        isClearOnly = false;
                        break;
                    }
                case 2:
                    {
                        isPendingOnly = false;
                        isClearOnly = true;
                        break;
                    }
                case 3:
                    {
                        isPendingOnly = true;
                        isClearOnly = true;
                        break;
                    }
                default:
                    isPendingOnly = true;
                    break;
            }

            Dynamic.ReportEntity.Inventory.PendingSalesOrderDetailsCollections dataColl = new Dynamic.Reporting.Inventory.PendingSalesOrderDetails(User.HostName, User.DBName).getPendingSalesDetails(User.UserId, dateFrom, dateTo, isPendingOnly, isClearOnly);

            return new JsonNetResultWithEnum() { Data = dataColl };
        }

        
        public ActionResult ProductGroupSummary()
        {
            return View();
        }
        [HttpPost]
        public JsonNetResult PrintProductGroupSummary()
        {
            var jsonData = Request["jsonData"];
            List<Dynamic.ReportEntity.Inventory.ProductGroupSummary> paraData = DeserializeObject<List<Dynamic.ReportEntity.Inventory.ProductGroupSummary>>(jsonData);
            ResponeValues resVal = new ResponeValues();
            try
            {
                var key = Guid.NewGuid().ToString().Replace("-", "");
                Session.Add(key, paraData);
                resVal.ResponseId = key;
                resVal.IsSuccess = true;
                return new JsonNetResult() { Data = resVal, TotalCount = 1, IsSuccess = true, ResponseMSG = GLOBALMSG.SUCCESS };
            }
            catch (Exception ee)
            {
                resVal.IsSuccess = false;
                resVal.ResponseMSG = ee.Message;

            }
            return new JsonNetResult() { Data = "", TotalCount = 0, IsSuccess = resVal.IsSuccess, ResponseMSG = resVal.ResponseMSG };
        }

        private Dynamic.BusinessEntity.Inventory.ProductGroupCollections ProductGroupColl = null;
        private Dynamic.ReportEntity.Inventory.ProductGroupSummaryCollections ProductGroupSummaryColl = null;
        [HttpPost]
        public JsonNetResultWithEnum GetProductGroupSummary()
        {
            Newtonsoft.Json.Linq.JObject para = DeserializeObject<Newtonsoft.Json.Linq.JObject>(Request["jsonData"]);
            Dynamic.ReportEntity.Inventory.ProductGroupSummary rootNote = new Dynamic.ReportEntity.Inventory.ProductGroupSummary();
            try
            {
                DateTime dateFrom = DateTime.Today;
                DateTime dateTo = DateTime.Today;
                int groupId = 1;
                bool showZeroBalance = false;
                if (para.ContainsKey("dateFrom") && para["dateFrom"] != null && !string.IsNullOrEmpty(para["dateFrom"].ToString()))
                    dateFrom = Convert.ToDateTime(para["dateFrom"]);

                if (para.ContainsKey("dateTo") && para["dateTo"] != null && !string.IsNullOrEmpty(para["dateTo"].ToString()))
                    dateTo = Convert.ToDateTime(para["dateTo"]);
 
                if (para.ContainsKey("groupId") && para["groupId"] != null && !string.IsNullOrEmpty(para["groupId"].ToString()))
                    groupId = Convert.ToInt32(para["groupId"]);

                if (para.ContainsKey("showZeroBalance") && para["showZeroBalance"] != null && !string.IsNullOrEmpty(para["showZeroBalance"].ToString()))
                    showZeroBalance = Convert.ToBoolean(para["showZeroBalance"]);

                List<int> ignoreList = new List<int>();
                ignoreList.Add(1);
                ProductGroupSummaryColl = new Dynamic.Reporting.Inventory.ProductGroupSummary(User.HostName, User.DBName).getProductGroupSummary(User.UserId, groupId, dateFrom, dateTo);
                ProductGroupColl = new Dynamic.DataAccess.Inventory.ProductGroupDB(User.HostName, User.DBName).getAllProductGroup(User.UserId);
                var rootGroup = ProductGroupColl.Find(p1 => p1.ProductGroupId == groupId);

                
                rootNote.DataType = Dynamic.ReportEntity.Inventory.ProductGroupDataTypes.ProductGroup;
                rootNote.ProductGroupId = groupId;
                rootNote.ProductGroupName = rootGroup.Name;


                AddChieldNodePG(rootNote,showZeroBalance);

                System.Collections.ArrayList root = new System.Collections.ArrayList();
                root.Add(rootNote);

            

                return new JsonNetResultWithEnum() { Data = root, TotalCount = 1, IsSuccess = ProductGroupSummaryColl.IsSuccess, ResponseMSG = ProductGroupSummaryColl.ResponseMSG };
            }
            catch (Exception ee)
            {
                return new JsonNetResultWithEnum() { Data = null, TotalCount = 0, IsSuccess = false, ResponseMSG = ee.Message };
            }
        }
        private void AddChieldNodePG(Dynamic.ReportEntity.Inventory.ProductGroupSummary beData,bool ShowZero)
        {
            var query = from lg in ProductGroupColl
                        where lg.ParentGroupId == beData.ProductGroupId
                        select lg;

            foreach (var v in query)
            {
                Dynamic.ReportEntity.Inventory.ProductGroupSummary node = new Dynamic.ReportEntity.Inventory.ProductGroupSummary();
                node.ProductGroupId = v.ProductGroupId;
                node.TotalSpace += beData.TotalSpace + 3;
                node.DataType = Dynamic.ReportEntity.Inventory.ProductGroupDataTypes.ProductGroup;
                node.ProductGroupName = v.Name;

                if (beData.ChieldColl != null && beData.ChieldColl.Count > 0)
                {
                    try
                    {
                        node.BaseUnit = beData.ChieldColl.Where(p1 => string.IsNullOrEmpty(p1.BaseUnit) == false).First().BaseUnit;
                        node.AUName1 = beData.ChieldColl.Where(p1 => string.IsNullOrEmpty(p1.AUName1) == false).First().AUName1;
                        node.AUName2 = beData.ChieldColl.Where(p1 => string.IsNullOrEmpty(p1.AUName1) == false).First().AUName2;
                        node.AUName3 = beData.ChieldColl.Where(p1 => string.IsNullOrEmpty(p1.AUName1) == false).First().AUName3;
                    }
                    catch { }
                }
                beData.ChieldColl.Add(node);
                AddChieldNodePG(node,ShowZero);
            }

            beData.ChieldColl.ForEach(delegate (Dynamic.ReportEntity.Inventory.ProductGroupSummary v)
            {
                beData.OpeningAmt += v.OpeningAmt;
                beData.OpeningQty += v.OpeningQty;
                beData.InAmt += v.InAmt;
                beData.InQty += v.InQty;
                beData.OutQty += v.OutQty;
                beData.OutAmt += v.OutAmt;
                beData.BalanceAmt += v.BalanceAmt;
                beData.BalanceQty += v.BalanceQty;

                beData.OpeningQty1 += v.OpeningQty1;
                beData.OpeningQty2 += v.OpeningQty2;
                beData.OpeningQty3 += v.OpeningQty3;

                beData.InQty1 += v.InQty1;
                beData.InQty2 += v.InQty2;
                beData.InQty3 += v.InQty3;

                beData.OutQty1 += v.OutQty1;
                beData.OutQty2 += v.OutQty2;
                beData.OutQty3 += v.OutQty3;

                beData.BalanceQty1 += v.BalanceQty1;
                beData.BalanceQty2 += v.BalanceQty2;
                beData.BalanceQty3 += v.BalanceQty3;

                beData.BaseUnit = v.BaseUnit;
                beData.AUName1 = v.AUName1;
                beData.AUName2 = v.AUName2;
                beData.AUName3 = v.AUName3;
            });


            var product = from pd in ProductGroupSummaryColl
                          where pd.ProductGroupId == beData.ProductGroupId
                          group pd by pd.ProductId into g
                          select new
                          {
                              ProductId = g.Key,
                              IsServiceType = g.First().IsServiceType,
                              ProductName = g.First().ProductName,
                              ProductGroupName = g.First().ProductGroupName,
                              ProductGroupId = g.First().ProductGroupId,
                              OpeningQty = g.Sum(p1 => p1.OpeningQty),
                              OpeningAmt = g.Sum(p1 => p1.OpeningAmt),
                              InQty = g.Sum(p1 => p1.InQty),
                              InAmt = g.Sum(p1 => p1.InAmt),
                              OutQty = g.Sum(p1 => p1.OutQty),
                              OutAmt = g.Sum(p1 => p1.OutAmt),
                              OpeningRateForBalance = g.First().RateForBalance,
                              UnitName = g.First().BaseUnit,
                              ChieldColl = g,
                              Code = g.First().ProductCode,
                              Alias = g.First().ProductAlias,
                              Remarks = g.First().ProductRemarks,
                              PartNo = g.First().ProductPartNo,
                              OpeningQty1 = g.Sum(p1 => p1.OpeningQty1),
                              OpeningQty2 = g.Sum(p1 => p1.OpeningQty2),
                              OpeningQty3 = g.Sum(p1 => p1.OpeningQty3),
                              InQty1 = g.Sum(p1 => p1.InQty1),
                              InQty2 = g.Sum(p1 => p1.InQty2),
                              InQty3 = g.Sum(p1 => p1.InQty3),
                              OutQty1 = g.Sum(p1 => p1.OutQty1),
                              OutQty2 = g.Sum(p1 => p1.OutQty2),
                              OutQty3 = g.Sum(p1 => p1.OutQty3),
                              AUName1 = g.First().AUName1,
                              AUName2 = g.First().AUName2,
                              AUName3 = g.First().AUName3,
                              PurchaseLedger = g.First().PurchaseLedger,
                              SalesLedger = g.First().SalesLedger

                          };


            foreach (var v in product)
            {
                if (v.OpeningQty != 0 || v.InQty != 0 || v.OutQty != 0 || ShowZero)
                {
                    Dynamic.ReportEntity.Inventory.ProductGroupSummary item = new Dynamic.ReportEntity.Inventory.ProductGroupSummary();
                    item.ProductId = v.ProductId;
                    item.ProductName = v.ProductName;
                    item.ProductGroupId = v.ProductGroupId;
                    item.ProductGroupName = v.ProductGroupName;
                    item.OpeningQty = v.OpeningQty;
                    item.OpeningAmt = v.OpeningAmt;
                    item.InQty = v.InQty;
                    item.InAmt = v.InAmt;
                    item.OutQty = v.OutQty;
                    item.OutAmt = v.OutAmt;

                    item.OpeningQty1 = v.OpeningQty1;
                    item.OpeningQty2 = v.OpeningQty2;
                    item.OpeningQty3 = v.OpeningQty3;

                    item.InQty1 = v.InQty1;
                    item.InQty2 = v.InQty2;
                    item.InQty3 = v.InQty3;

                    item.OutQty1 = v.OutQty1;
                    item.OutQty2 = v.OutQty2;
                    item.OutQty3 = v.OutQty3;

                    item.AUName1 = v.AUName1;
                    item.AUName2 = v.AUName2;
                    item.AUName3 = v.AUName3;

                    if (item.InQty != 0 && item.InAmt != 0)
                        item.InRate = Math.Abs(item.InAmt / item.InQty);

                    if (item.OpeningQty != 0 && item.OpeningAmt != 0)
                        item.OpeningRate = Math.Abs(item.OpeningAmt / item.OpeningQty);

                    if (!v.IsServiceType)
                    {
                        item.BalanceQty1 = v.OpeningQty1 + v.InQty1 - v.OutQty1;
                        item.BalanceQty2 = v.OpeningQty2 + v.InQty2 - v.OutQty2;
                        item.BalanceQty3 = v.OpeningQty3 + v.InQty3 - v.OutQty3;

                        item.BalanceQty = v.OpeningQty + v.InQty - v.OutQty;


                        double totalQty = item.InQty + item.OpeningQty;
                        double totalAmt = item.InAmt + item.OpeningAmt;

                        if (totalAmt != 0 && totalQty != 0)
                            item.BalanceRate = Math.Abs(totalAmt / totalQty);

                        //if (!Dynamic.BusinessEntity.Global.GlobalObject.InventoryConfig.OpeningRateAsBalanceRate)
                        //{
                        //    if (totalAmt != 0 && totalQty != 0)
                        //        item.BalanceRate = Math.Abs(totalAmt / totalQty);
                        //}
                        //else
                        //{
                        //    item.BalanceRate = v.OpeningRateForBalance;
                        //}

                        item.BalanceAmt = item.BalanceQty * item.BalanceRate;
                    }

                    item.DataType = Dynamic.ReportEntity.Inventory.ProductGroupDataTypes.Product;
                    item.BaseUnit = v.UnitName;
                    item.ProductCode = v.Code;
                    item.ProductAlias = v.Alias;
                    item.ProductPartNo = v.PartNo;
                    item.ProductRemarks = v.Remarks;
                    item.PurchaseLedger = v.PurchaseLedger;
                    item.SalesLedger = v.SalesLedger;

                    beData.OpeningAmt += v.OpeningAmt;
                    beData.OpeningQty += v.OpeningQty;
                    beData.InAmt += v.InAmt;
                    beData.InQty += v.InQty;
                    beData.OutQty += v.OutQty;
                    beData.OutAmt += v.OutAmt;
                    beData.BalanceAmt += item.BalanceAmt;
                    beData.BalanceQty += item.BalanceQty;

                    beData.OpeningQty1 += item.OpeningQty1;
                    beData.OpeningQty2 += item.OpeningQty2;
                    beData.OpeningQty3 += item.OpeningQty3;

                    beData.InQty1 += item.InQty1;
                    beData.InQty2 += item.InQty2;
                    beData.InQty3 += item.InQty3;

                    beData.OutQty1 += item.OutQty1;
                    beData.OutQty2 += item.OutQty2;
                    beData.OutQty3 += item.OutQty3;

                    beData.BalanceQty1 += item.BalanceQty1;
                    beData.BalanceQty2 += item.BalanceQty2;
                    beData.BalanceQty3 += item.BalanceQty3;
                    beData.AUName1 = item.AUName1;
                    beData.AUName2 = item.AUName2;
                    beData.AUName3 = item.AUName3;
                    beData.BaseUnit = item.BaseUnit;
                    beData.PurchaseLedger = item.PurchaseLedger;
                    beData.SalesLedger = item.SalesLedger;

                    if (beData.BalanceAmt != 0 && beData.BalanceQty != 0)
                        beData.BalanceRate = Math.Abs(beData.BalanceAmt / beData.BalanceQty);

                    if (beData.BalanceQty == 0)
                        beData.BalanceRate = 0;

                    foreach (var vv in v.ChieldColl)
                    {
                        vv.DataType = Dynamic.ReportEntity.Inventory.ProductGroupDataTypes.Godown;
                        item.ChieldColl.Add(vv);
                    }

                    beData.ChieldColl.Add(item);
                }
            }

        }


        
        public ActionResult ProductGroupSummaryList()
        {
            return View();
        }

        [HttpPost]
        public JsonNetResultWithEnum GetProductGroupSummaryAsList()
        {
            Newtonsoft.Json.Linq.JObject para = DeserializeObject<Newtonsoft.Json.Linq.JObject>(Request["jsonData"]);
            Dynamic.ReportEntity.Inventory.ProductGroupSummary rootNote = new Dynamic.ReportEntity.Inventory.ProductGroupSummary();
            try
            {
                DateTime dateFrom = DateTime.Today;
                DateTime dateTo = DateTime.Today;
                int groupId = 1;
                bool showZeroBalance = false;
                if (para.ContainsKey("dateFrom") && para["dateFrom"] != null && !string.IsNullOrEmpty(para["dateFrom"].ToString()))
                    dateFrom = Convert.ToDateTime(para["dateFrom"]);

                if (para.ContainsKey("dateTo") && para["dateTo"] != null && !string.IsNullOrEmpty(para["dateTo"].ToString()))
                    dateTo = Convert.ToDateTime(para["dateTo"]);

                if (para.ContainsKey("groupId") && para["groupId"] != null && !string.IsNullOrEmpty(para["groupId"].ToString()))
                    groupId = Convert.ToInt32(para["groupId"]);

                if (para.ContainsKey("showZeroBalance") && para["showZeroBalance"] != null && !string.IsNullOrEmpty(para["showZeroBalance"].ToString()))
                    showZeroBalance = Convert.ToBoolean(para["showZeroBalance"]);

               
                var ProductGroupSummaryAsListColl = new Dynamic.Reporting.Inventory.ProductGroupSummary(User.HostName, User.DBName).getProductGroupSummary(User.UserId, groupId, dateFrom, dateTo);
                 

                return new JsonNetResultWithEnum() { Data = ProductGroupSummaryAsListColl, TotalCount = ProductGroupSummaryAsListColl.Count, IsSuccess = ProductGroupSummaryAsListColl.IsSuccess, ResponseMSG = ProductGroupSummaryAsListColl.ResponseMSG };
            }
            catch (Exception ee)
            {
                return new JsonNetResultWithEnum() { Data = null, TotalCount = 0, IsSuccess = false, ResponseMSG = ee.Message };
            }
        }

        
        public ActionResult ProductVoucher()
        {
            return View();
        }
        [HttpPost]
        public JsonNetResultWithEnum GetProductVoucher(DateTime dateFrom, DateTime dateTo, int productId)
        {
            Dynamic.BusinessEntity.Global.GlobalObject.CurrentUser = User;

            Dynamic.BusinessEntity.Inventory.Product selectedProduct = new Dynamic.DataAccess.Inventory.ProductDB(User.HostName, User.DBName).getProductById(User.UserId, productId);

            double openingAmt = 0;
            double openingQty = 0;
            double closingRate = 0;
            DateTime openingDateAD = DateTime.Today;
            string openingDateBS = "";
            Dynamic.ReportEntity.Account.StockReport stkRpt = new Dynamic.ReportEntity.Account.StockReport();
            var tmpColl = new Dynamic.Reporting.Inventory.ProductMonthlySummary(User.HostName, User.DBName).getProductVoucher(ref stkRpt, User.UserId, productId, dateFrom, dateTo, ref openingQty, ref openingAmt, ref closingRate,ref openingDateAD,ref openingDateBS);

            if (openingAmt != 0 || openingQty != 0)
            {
                Dynamic.ReportEntity.Inventory.ProductVoucher voucher = new Dynamic.ReportEntity.Inventory.ProductVoucher();
                voucher.PartyLedger = "Opening Balance";
                voucher.VoucherDate = Dynamic.BusinessEntity.Global.GlobalObject.CurrentCompany.StartDate;
                voucher.InQty = openingQty;
                voucher.InAmt = openingAmt;
                voucher.IsOpening = true;
                if (openingAmt != 0 && openingQty != 0)
                    voucher.InRate = openingAmt / openingQty;

                voucher.BalanceQty = openingQty;
                voucher.BalanceAmt = openingAmt;
                voucher.BalanceRate = voucher.InRate;
                voucher.VoucherSNo = 0;

                if (tmpColl.Count > 0)
                    tmpColl.Insert(0, voucher);
                else
                    tmpColl.Add(voucher);

            }

            Dynamic.ReportEntity.Inventory.ProductVoucherCollections tmpDataColl = new Dynamic.ReportEntity.Inventory.ProductVoucherCollections();
             
            double curQty = 0, curRate = 0;
            double curInQty = 0, curInAmt = 0;

            var query = from q in tmpColl
                        orderby q.VoucherDate, q.VoucherSNo
                        select q;
            //foreach (var v in tmpColl)

            Dynamic.ReportEntity.Inventory.ProductVoucherCollections inDataOnlyColl = new Dynamic.ReportEntity.Inventory.ProductVoucherCollections();

            double negativeBal = 0;

            double curAmt = 0;

            foreach (var v in query)
            {
                if (v.InAmt != 0 && v.InQty != 0)
                    v.InRate = Math.Round((v.InAmt / v.InQty),3);

                if (v.OutAmt != 0 && v.OutQty != 0)
                    v.OutRate = Math.Round((v.OutAmt / v.OutQty),3);

                if (v.OutQty == 0)
                {
                    v.AfterIssueQty = v.InQty;
                    v.IssueAmt = v.InAmt;
                    inDataOnlyColl.Add(v);
                }

                curInQty += v.InQty;
                curInAmt += v.InAmt;
                curQty += (v.InQty - v.OutQty);
                curAmt += (v.InAmt - v.OutAmt);

                if (curInQty != 0 && curInAmt != 0)
                    curRate = Math.Round((curInAmt / curInQty),3);

                v.BalanceQty = curQty;

                if (v.BalanceQty < 0)
                    negativeBal = Math.Abs(v.BalanceQty);
                else
                    negativeBal = 0;

                switch (selectedProduct.CostingMethod)
                {
                    case Dynamic.BusinessEntity.Inventory.CostingMethods.At_Zero_Cost:
                        curRate = 0;
                        break;
                    case Dynamic.BusinessEntity.Inventory.CostingMethods.Monthly_Avg_Cost:
                    case Dynamic.BusinessEntity.Inventory.CostingMethods.Avg_Cost:
                        {
                            double totalIn = inDataOnlyColl.Sum(p1 => p1.InQty);
                            double totalInAmt = inDataOnlyColl.Sum(p1 => p1.InAmt);

                            if (totalIn != 0 && totalInAmt != 0)
                                curRate = Math.Round((totalInAmt / totalIn),3);
                        }
                        break;
                    case Dynamic.BusinessEntity.Inventory.CostingMethods.FIFO:
                        {
                            var queryIn = inDataOnlyColl.Where(p1 => p1.AfterIssueQty > 0);
                            double hOut = v.OutQty + negativeBal;
                            System.Collections.Generic.List<Dynamic.ReportEntity.Inventory.ProductVoucher> tmpC = new List<Dynamic.ReportEntity.Inventory.ProductVoucher>();
                            foreach (var iV in queryIn)
                            {
                                if (iV.AfterIssueQty > hOut)
                                {
                                    iV.IssueQty = iV.IssueQty + hOut;
                                    iV.AfterIssueQty = iV.InQty - iV.IssueQty;
                                    iV.IssueAmt = iV.AfterIssueQty * iV.InRate;
                                    break;
                                }
                                else
                                {
                                    hOut -= iV.AfterIssueQty;
                                    tmpC.Add(iV);
                                }
                            }

                            if (hOut > 0)
                                negativeBal = hOut;

                            foreach (var vvv in tmpC)
                                inDataOnlyColl.Remove(vvv);

                            double totalIn = inDataOnlyColl.Sum(p1 => p1.AfterIssueQty);
                            double totalInAmt = inDataOnlyColl.Sum(p1 => p1.IssueAmt);

                            if (totalIn != 0 && totalInAmt != 0)
                                curRate = Math.Round((totalInAmt / totalIn),3);

                        }

                        break;
                    case Dynamic.BusinessEntity.Inventory.CostingMethods.Last_Purchase_Cost:
                        if (inDataOnlyColl.Count > 0)
                            curRate = inDataOnlyColl.Last().InRate;
                        else
                            curRate = 0;
                        break;
                    case Dynamic.BusinessEntity.Inventory.CostingMethods.LIFO:
                        {
                            var queryIn = inDataOnlyColl.Where(p1 => p1.AfterIssueQty > 0).OrderByDescending(p1 => p1.VoucherDate).OrderByDescending(p1 => p1.TranId);
                            double hOut = v.OutQty + negativeBal;
                            System.Collections.Generic.List<Dynamic.ReportEntity.Inventory.ProductVoucher> tmpC = new List<Dynamic.ReportEntity.Inventory.ProductVoucher>();
                            foreach (var iV in queryIn)
                            {
                                if (iV.AfterIssueQty > hOut)
                                {
                                    iV.IssueQty = iV.IssueQty + hOut;
                                    iV.AfterIssueQty = iV.InQty - iV.IssueQty;
                                    iV.IssueAmt = iV.AfterIssueQty * iV.InRate;
                                    break;
                                }
                                else
                                {
                                    hOut -= iV.AfterIssueQty;
                                    tmpC.Add(iV);
                                }
                            }

                            if (hOut > 0)
                                negativeBal = hOut;

                            foreach (var vvv in tmpC)
                                inDataOnlyColl.Remove(vvv);

                            double totalIn = inDataOnlyColl.Sum(p1 => p1.AfterIssueQty);
                            double totalInAmt = inDataOnlyColl.Sum(p1 => p1.IssueAmt);

                            if (totalIn != 0 && totalInAmt != 0)
                                curRate = Math.Round((totalInAmt / totalIn),3);

                        }

                        break;
                    case Dynamic.BusinessEntity.Inventory.CostingMethods.Std_Cost:
                        curRate = closingRate;
                        break;
                    case Dynamic.BusinessEntity.Inventory.CostingMethods.InOut_Amount:

                        if (curQty != 0 && curAmt != 0)
                            curRate = curAmt / curQty;

                        break;
                }

                if (v.BalanceQty == 0)
                    curRate = 0;

                v.BalanceRate = curRate;
                v.BalanceAmt = v.BalanceQty * v.BalanceRate;


              

                tmpDataColl.Add(v);
            }

            double inQty = 0, inAmt = 0, inRate = 0;
            double outQty = 0, outRate = 0, outAmt = 0;
            double clQty = 0, clAmt = 0, clRate = 0;
            inQty = tmpDataColl.Sum(p1 => p1.InQty);
            inAmt = tmpDataColl.Sum(p1 => p1.InAmt);
            outQty = tmpDataColl.Sum(p1 => p1.OutQty);
            outAmt = tmpDataColl.Sum(p1 => p1.OutAmt);

            try
            {
                inRate = inAmt / inQty;
            }
            catch (Exception) { }

            try
            {
                outRate = outAmt / outQty;
            }
            catch (Exception) { }


            clQty = inQty - outQty;
            clAmt = inAmt - outAmt;

            try
            {  
                clRate = curRate;
                clAmt = clQty * clRate;
            }
            catch (Exception) { }

            var returnVal = new
            {
                OpeningQty=openingQty,
                OpeningAmt = openingAmt,                
                InQty=inQty,
                InAmt=inAmt,
                InRate=inRate,
                OutQty=outQty,
                OutAmt=outAmt,
                OutRate=outRate,
                BalanceQty=clQty,
                BalanceAmt=clAmt,
                BalanceRate=clRate,
                DataColl = tmpDataColl
            };
            return new JsonNetResultWithEnum() { Data = returnVal };
        }

        [HttpPost]
        public JsonNetResult PrintProductVoucher()
        {
            var jsonData = Request["jsonData"];
            List<Dynamic.ReportEntity.Account.LedgerVoucher> paraData = DeserializeObject<List<Dynamic.ReportEntity.Account.LedgerVoucher>>(jsonData);
            ResponeValues resVal = new ResponeValues();
            try
            {
                var key = Guid.NewGuid().ToString().Replace("-", "");
                Session.Add(key, paraData);
                resVal.ResponseId = key;
                resVal.IsSuccess = true;
                return new JsonNetResult() { Data = resVal, TotalCount = 1, IsSuccess = true, ResponseMSG = GLOBALMSG.SUCCESS };
            }
            catch (Exception ee)
            {
                resVal.IsSuccess = false;
                resVal.ResponseMSG = ee.Message;

            }
            return new JsonNetResult() { Data = "", TotalCount = 0, IsSuccess = resVal.IsSuccess, ResponseMSG = resVal.ResponseMSG };
        }


        
        public ActionResult ConsumptionList()
        {
            return View();
        }

        [HttpPost]
        public JsonNetResultWithEnum GetConsumptionList()
        {
            Newtonsoft.Json.Linq.JObject para = DeserializeObject<Newtonsoft.Json.Linq.JObject>(Request["jsonData"]);
            Dynamic.ReportEntity.Inventory.ProductGroupSummary rootNote = new Dynamic.ReportEntity.Inventory.ProductGroupSummary();
            try
            {
                DateTime dateFrom = DateTime.Today;
                DateTime dateTo = DateTime.Today;
       
                if (para.ContainsKey("dateFrom") && para["dateFrom"] != null && !string.IsNullOrEmpty(para["dateFrom"].ToString()))
                    dateFrom = Convert.ToDateTime(para["dateFrom"]);

                if (para.ContainsKey("dateTo") && para["dateTo"] != null && !string.IsNullOrEmpty(para["dateTo"].ToString()))
                    dateTo = Convert.ToDateTime(para["dateTo"]);

                var consumptionList = new Dynamic.Reporting.Inventory.Consumption(User.HostName, User.DBName).getConsumationList(User.UserId, dateFrom, dateTo);


                return new JsonNetResultWithEnum() { Data = consumptionList, TotalCount = consumptionList.Count, IsSuccess = consumptionList.IsSuccess, ResponseMSG = consumptionList.ResponseMSG };
            }
            catch (Exception ee)
            {
                return new JsonNetResultWithEnum() { Data = null, TotalCount = 0, IsSuccess = false, ResponseMSG = ee.Message };
            }
        }
    }
}