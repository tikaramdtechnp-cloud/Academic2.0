

<script src="~/jslib/setup/ReportTemplate.js?v=20251115"></script>
<style>
    .example {
        float: left;
        margin: 15px;
    }

    .demo {
        width: 400px;
        height: 400px;
        border-top: solid 1px #BBB;
        border-left: solid 1px #BBB;
        border-bottom: solid 1px #FFF;
        border-right: solid 1px #FFF;
        background: #FFF;
        overflow: scroll;
        padding: 5px;
    }
</style>
<script>
    var selectedFolderPath = '';
    var selectedFilePath = '';
    var EntityId = "@ViewBag.EntityId";
</script>

<link href="~/Scripts/jqueryFileTree.css" rel="stylesheet" />

<div class="hold-transition  layout-navbar-fixed" ng-app="myApp" ng-controller="reportTemplatesCntrl" ng-class="{waiting: loadingstatus=='running'}">
    <section class="content">
        <div class="container-fluid">
            <section class="iframe-content-starts-here" style="padding-top:52px!important">
                <div class="tab-content" id="pills-tabContent">
                    <div id="report-listing" class="card py-2">
                        <div class="row">
                            <div class="col-md-5">
                                <div class="form-group d-flex">
                                    <label class="control-label" style="min-width:100px;">
                                        Select Type <span id="ErrPassword" style="color:red;"></span>
                                    </label>
                                    <select ng-model="ReportTemplates.RptType" class="form-control  form-control-sm">
                                        <option ng-repeat="cl in TemplatesTypes track by cl.id" value="{{cl.id}}">
                                            {{cl.text}}
                                        </option>
                                    </select>
                                </div>
                            </div>
                            <div class="col-md-2">
                                <button class="btn btn-success btn-sm ml-4" type="button" ng-click="GetAllReportTemplates()"><i class="fa fa-sync-alt mr-2"></i>Load</button>
                            </div>
                            <div class="col-md-5">
                                <div class="form-inline float-right">
                                    <div class="form-group">
                                        <label class="control-label">
                                            &nbsp; <span id="ErrRePassword" style="color:red;"></span>
                                        </label>
                                        <div class="input-group">
                                            <div class="btn btn-sm btn-secondary btn-file">
                                                <i class="fa fa-upload"></i> Upload Files
                                                <input type="file" name="file" onchange="angular.element(this).scope().uploadFiles(this)" multiple />
                                            </div>

                                        </div>
                                    </div>
                                    <button type="button"
                                            class="btn btn-sm btn-info ml-2"
                                            style="min-width: 90px" ng-click="AllowFolderAccess()">
                                        <i class="fas fa-save mr-2"></i>Allow Access
                                    </button>
                                </div>
                            </div>
                           
                        </div>
                        <header class="row">
                            <div class="col-md-7">
                                <div class="clearfix">
                                    <form class="form-inline">

                                        <div class="input-group input-group-sm mr-sm-2">
                                            <div class="input-group-prepend">
                                                <span class="input-group-text cstm">Show</span>
                                            </div>
                                            <!-- <input type="text" class="form-control border-left-0" placeholder=""> -->
                                            <select class="form-control border-left-0 border-right-0 pr-0" ng-model="perPage.RptTemplate">
                                                <option ng-value="pp.value" ng-repeat="pp in perPageColl" ng-selected="pp.value==perPage.RptTemplate">{{pp.text}}</option>
                                            </select>
                                            <div class="input-group-append">
                                                <span class="input-group-text bg-white"><small>entries</small></span>
                                            </div>
                                        </div>
                                        <div class="input-group input-group-sm table-search-filed">
                                            <input class="form-control form-control-navbar"
                                                   type="search" placeholder="Search"
                                                   aria-label="Search" ng-model="searchData.RptTemplate">
                                            <div class="input-group-append">
                                                <button class="btn btn-default border-left-0"
                                                        type="submit">
                                                    <i class="fas fa-search"></i>
                                                </button>
                                            </div>
                                        </div>
                                    </form>
                                </div>
                            </div>
                            <!-- end col-md-8 -->
                            <div class="col-md-5 text-right">
                                <div class="dropdown dnld-file" data-toggle="tooltip"
                                     data-placement="bottom" title="Download File">
                                    <button class="btn btn-secondary btn-light btn-sm dropdown-toggle"
                                            type="button" id="dropdownMenuButton"
                                            data-toggle="dropdown" aria-haspopup="true"
                                            aria-expanded="false">
                                        <i class="fas fa-download"></i>
                                    </button>
                                    <div class="dropdown-menu dropdown-menu-right"
                                         aria-labelledby="dropdownMenuButton">
                                        <a class="dropdown-item" href="#"><img src="~/wwwroot/dynamic/images/flaticons/excel.png" class="img-fluid exports-icon" alt="Excel image"> Excel</a>
                                        <a class="dropdown-item" href="#"><img src="~/wwwroot/dynamic/images/flaticons/csv.png" class="img-fluid exports-icon" alt="Excel image"> CSV</a>
                                    </div>
                                </div>
                                <a href="#" class="btn btn-secondary btn-light btn-sm"
                                   data-toggle="tooltip" data-placement="bottom"
                                   title="Print">
                                    <i class="fas fa-print"></i>
                                </a>
                                <a href="#" class="btn btn-success btn-sm" id="add-report">
                                    <i class="fas fa-plus w-t"></i> Add New Templates
                                </a>

                            </div>

                        </header>
                        <div class="table-scroll-x-y table-scroll">
                            <table id="main-table" class="main-table table table-sm table-bordered bg-white" style="height: auto;">
                                <thead>
                                    <tr>
                                        <th ng-click="sort('SNo')" style="width: 50px; text-align:center">
                                            S.No.
                                            <span class="glyphicon sort-icon" ng-show="sortKey=='SNo'" ng-class="{'glyphicon-chevron-up':reverse,'glyphicon-chevron-down':!reverse}"></span>
                                        </th>
                                        <th ng-click="sort('Entity')" style="width: 160px; text-align: center">
                                            Entity
                                            <span class="glyphicon sort-icon" ng-show="sortKey=='Entity'" ng-class="{'glyphicon-chevron-up':reverse,'glyphicon-chevron-down':!reverse}"></span>
                                        </th>
                                        <th ng-click="sort('Name')" style="width: 160px; text-align: center">
                                            Name
                                            <span class="glyphicon sort-icon" ng-show="sortKey=='Name'" ng-class="{'glyphicon-chevron-up':reverse,'glyphicon-chevron-down':!reverse}"></span>
                                        </th>
                                        <th ng-click="sort('Description')" style="width: 200px; text-align: center">
                                            Description
                                            <span class="glyphicon sort-icon" ng-show="sortKey=='Description'" ng-class="{'glyphicon-chevron-up':reverse,'glyphicon-chevron-down':!reverse}"></span>
                                        </th>
                                        <th ng-click="sort('Path')" style="width: 200px; text-align: center">
                                            Path
                                            <span class="glyphicon sort-icon" ng-show="sortKey=='Path'" ng-class="{'glyphicon-chevron-up':reverse,'glyphicon-chevron-down':!reverse}"></span>
                                        </th>
                                        <th ng-click="sort('IsDefault')" style="width: 77px; text-align: center">
                                            IsDefault
                                            <span class="glyphicon sort-icon" ng-show="sortKey=='IsDefault'" ng-class="{'glyphicon-chevron-up':reverse,'glyphicon-chevron-down':!reverse}"></span>
                                        </th>
                                        <th ng-click="sort('ForEmail')" style="width: 77px; text-align: center">
                                            For Email
                                            <span class="glyphicon sort-icon" ng-show="sortKey=='ForEmail'" ng-class="{'glyphicon-chevron-up':reverse,'glyphicon-chevron-down':!reverse}"></span>
                                        </th>
                                        <th ng-click="sort('IsActive')" style="width: 77px; text-align: center">
                                            Is Active
                                            <span class="glyphicon sort-icon" ng-show="sortKey=='IsActive'" ng-class="{'glyphicon-chevron-up':reverse,'glyphicon-chevron-down':!reverse}"></span>
                                        </th>
                                        <th style="width: 70px; text-align: center"><b>Action</b></th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr dir-paginate="beData in DataColl | filter:searchData.RptTemplate | itemsPerPage: perPage.RptTemplate" current-page="currentPages.RptTemplate" pagination-id="classPagination">
                                        <td class="text-center">
                                            {{$index+1}}
                                        </td>
                                        <td>
                                            {{beData.EntityName}}
                                        </td>
                                        <td>
                                            <a download="{{beData.ReportName}}.zip" href="~/Setup/Security/DownloadAllReportTemplates?fpath={{beData.Path}}">{{beData.ReportName}} </a>
                                        </td>
                                        <td>
                                            {{beData.Description}}
                                        </td>
                                        <td>
                                            <a download="{{beData.FileName}}" href="~/Setup/Security/DownloadReportTemplates?fpath={{beData.Path}}">{{ beData.Path}} </a>
                                        </td>
                                        <td>
                                            <div class="custom-control custom-checkbox ml-3">
                                                <input type="checkbox" class="custom-control-input"
                                                       id="chkColumnFocus{{$index+1}}" ng-model="beData.IsDefault">
                                                <label for="chkColumnFocus{{$index+1}}"
                                                       class="custom-control-label"></label>
                                            </div>
                                        </td>
                                        <td>
                                            <div class="custom-control custom-checkbox ml-3">
                                                <input type="checkbox" class="custom-control-input"
                                                       id="chkColumnEmail{{$index+1}}" ng-model="beData.ForEmail">
                                                <label for="chkColumnEmail{{$index+1}}"
                                                       class="custom-control-label"></label>
                                            </div>
                                        </td>
                                        <td>
                                            <div class="custom-control custom-checkbox ml-3">
                                                <input type="checkbox" class="custom-control-input"
                                                       id="chkColumnIsActive{{$index+1}}" ng-model="beData.IsActive">
                                                <label for="chkColumnIsActive{{$index+1}}"
                                                       class="custom-control-label"></label>
                                            </div>
                                        </td>
                                        <td>
                                            <a class="p-1" href="#" ng-click="uploadReportTemplate(beData)">
                                                <i class="fas fa-upload text-secondary"></i>
                                            </a>
                                            @*<a class="p-1" href="#" ng-click="getReportTemplateById(beData)">
                                                <i class="fas fa-edit text-info"></i>
                                            </a>*@
                                            <a class="p-1" href="#" ng-click="deleteReportTemplate(beData)">
                                                <i class="fas fa-trash-alt text-danger"></i>
                                            </a>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                            <!-- table end -->
                        </div>

                        <footer class="row align-items-center">
                            <div class="col-md-12">
                                <dir-pagination-controls pagination-id="classPagination" boundary-links="true" on-page-change="pageChangeHandler(newPageNumber)" template-url="/Scripts/dirPagination.tpl.html">
                                </dir-pagination-controls>
                            </div>
                        </footer>

                    </div>


                    <div id="report-form">
                        <div class="card py-2">
                            <div class="row">
                                <div class="col-md-4">
                                    <div class="form-group">
                                        <label for="txtName" class="col-sm-4" style="text-align: left; vertical-align: middle; ">For</label>

                                        <select ng-model="beData.RptType" class="form-control form-control-sm">
                                            <option ng-repeat="cl in TemplatesTypes track by cl.id" value="{{cl.id}}" ng-selected="cl.id==beData.RptType">
                                                {{cl.text}}
                                            </option>
                                        </select>

                                    </div>
                                </div>
                                <div class="col-md-4" ng-show="beData.RptType==1">
                                    <div class="form-group">
                                        <label for="txtName">Entity</label>

                                        @Html.DropDownList("cboTranEntity", (SelectList)@ViewBag.TranEntityColl, new { @ng_model = "beData.EntityId", @style = "width:100%", @class = "form-control-sm form-control" })

                                    </div>
                                </div>
                                <div class="col-md-4" ng-show="beData.RptType==2">
                                    <div class="form-group">
                                        <label for="txtName">Entity</label>

                                        @Html.DropDownList("cboRptEntity", (SelectList)@ViewBag.RptEntityColl, new { @ng_model = "beData.EntityId", @style = "width:100%", @class = "form-control-sm form-control" })

                                    </div>
                                </div>


                                <div class="col-md-4">
                                    <div class="form-group">
                                        <label for="txtName">Name</label>
                                        <input type="text" multiple class="form-control form-control-sm" ng-model="beData.ReportName" id="txtReportName" />

                                    </div>
                                </div>
                                <div class="col-md-7">
                                    <div class="form-group">
                                        <label for="txtName">Path</label>
                                        <input type="text" class="form-control form-control-sm" ng-model="beData.Path" />
                                    </div>
                                </div>
                                <div class="col-md-1">
                                    <div class="input-group mt-4">
                                        <button class="btn btn-success btn-sm" type="button" data-toggle="modal" data-target="#addReportFilePath"><i class="fas fa-file-invoice"></i></button>
                                    </div>
                                </div>
                                <div class="col-md-4 d-flex">
                                    @*<div class="form-group mt-4">
                                        <label>
                                            Is Default
                                            <input type="checkbox" class="icheckbox_square-blue ml-2" ng-model="beData.IsDefault">
                                        </label>
                                    </div>*@
                                    <div class="col-md-4">
                                        <div class="custom-control custom-checkbox mt-4">
                                            <input class="custom-control-input" type="checkbox"
                                                   id="IsDefault" ng-model="beData.IsDefault">
                                            <label for="IsDefault"
                                                   class="custom-control-label">
                                                Is Default
                                            </label>
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <div class="custom-control custom-checkbox mt-4">
                                            <input class="custom-control-input" type="checkbox"
                                                   id="ForEmail" ng-model="beData.ForEmail">
                                            <label for="ForEmail"
                                                   class="custom-control-label">
                                                For Email
                                            </label>
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <div class="custom-control custom-checkbox mt-4">
                                            <input class="custom-control-input" type="checkbox"
                                                   id="IsActive" ng-model="beData.IsActive">
                                            <label for="IsActive"
                                                   class="custom-control-label">
                                                Is Active
                                            </label>
                                        </div>
                                    </div>
                                </div>

                                <div class="col-md-12">
                                    <div class="form-group">
                                        <label for="txtName">Description</label>
                                        <input type="text" class="form-control form-control-sm" ng-model="beData.Description" />
                                    </div>
                                </div>
                                @*<div class="col-md-2">
                                    <div class="form-group mt-4">
                                        <label>
                                            For Email
                                            <input type="checkbox" class="icheckbox_square-blue ml-2" ng-model="beData.ForEmail">
                                        </label>
                                    </div>
                                </div>*@


                            </div>

                            <div class="time-label">
                                <span class="d-block border-0 p-3 text-center">
                                    <button type="button" class="btn btn-sm btn-info" id="back-btn-list">Back to List</button>
                                    <button type="button" class="btn btn-sm btn-default" style="min-width: 90px">Reset</button>
                                    <button type="button" class="btn btn-sm btn-success" style="min-width: 90px" id="btnSave" ng-click="AddNewReportTemplate()">Accept</button>
                                </span>
                            </div>

                        </div>
                    </div>


                </div>
            </section>
            <!-- /.row -->

        </div>
        <!--/. container-fluid -->
    </section>


    <!-- End Add User Modal -->
    <!-- Add Report Path Modal -->
    <div class="modal fade" id="addReportFilePath" role="dialog" aria-labelledby="myModalLabel3" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h6 class="modal-title">Select Report Files</h6>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <div class="row">
                        <div class="col-md-12">
                            <div class="example">
                                <div id="fileTreeDemo_2" class="demo"></div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="time-label">
                    <span class="d-block border-0 p-3 text-center">
                        <button type="button" class="btn btn-sm btn-success" id="btnCancel" data-dismiss="modal" ng-click="SelectedFileClick()">Accept</button>
                    </span>
                </div>

            </div>
        </div>
    </div>
    <!-- End Add User Modal -->
    <!-- Add uploadRptFiles Path Modal -->
    <div class="modal fade" id="uploadRptFiles" role="dialog" aria-labelledby="myModalLabel3" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h6 class="modal-title">Upload Report Files</h6>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <div class="row">
                        <!-- User List -->
                        <div>
                            <div class="box-body">
                                <table class="table table-bordered table-striped table-hover table-responsive">
                                    <tr>
                                        <th ng-click="sort('SNo')" style="width: 80px; text-align:center">
                                            S.No.
                                            <span class="glyphicon sort-icon" ng-show="sortKey=='SNo'" ng-class="{'glyphicon-chevron-up':reverse,'glyphicon-chevron-down':!reverse}"></span>
                                        </th>
                                        <th ng-click="sort('Entity')" style="width: 320px; text-align:center">
                                            Name
                                            <span class="glyphicon sort-icon" ng-show="sortKey=='Entity'" ng-class="{'glyphicon-chevron-up':reverse,'glyphicon-chevron-down':!reverse}"></span>
                                        </th>
                                        <th style="width: 70px; text-align:center"><b>Action</b></th>
                                    </tr>
                                    <tr ng-repeat="beData in files">
                                        <td align="center">
                                            {{$index+1}}
                                        </td>
                                        <td>
                                            {{beData.name}}
                                        </td>
                                        <td style="white-space:nowrap">
                                            <a class="p-1" href="#" ng-click="deleteUploadFiles($index)">
                                                <i class="fas fa-trash-alt text-danger"></i>
                                            </a>
                                        </td>
                                    </tr>
                                </table>
                            </div>
                        </div>
                        <!-- End User List -->
                    </div>
                    <div class="row">
                        <div class="col-md-8">
                            <div class="form-group">
                                <div class="form-group">
                                    <label for="txtName" style="vertical-align: middle; " ng-click="GetFolderAndFiles('Report')"><i class="text-secondary fa fa-folder"></i>  Report ( {{currentPath}} )</></label>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-8">
                            <div class="form-group">
                                <label class="control-label">
                                    Folder Name <span id="ErrName" style="color:red;"></span>
                                </label>
                                <div class="input-group">
                                    <span class="input-group-addon"><i class="fa fa-folder text-secondary" style="font-size:20px;"></i></span>
                                    <input type="text" class="form-control form-control-sm ml-2" ng-model="beData.FolderName" />
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <label class="control-label">
                                &ensp; <span id="ErrName" style="color:red;"></span>
                            </label>
                            <div class="input-group">
                                <button class="btn btn-secondary btn-sm" type="button" ng-click="MakeNewFolder()"><i class="fas fa-file-alt "></i></button>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-10">
                            <ul>
                                <li ng-repeat="cl in FileFoldersList">
                                    <a href="#" ng-click="GetFolderAndFiles(cl.Path)">

                                        <i ng-class="(cl.IsFolder==true) ? 'fa fa-folder' : 'fa fa-file' "></i> <span>{{cl.Name}}</span>
                                    </a>
                                </li>
                            </ul>
                        </div>

                    </div>
                </div>

                <div class="time-label">
                    <span class="d-block border-0 p-3 text-center">
                        <button type="button" class="btn btn-sm btn-success" id="btnCancel" data-dismiss="modal" ng-click="uploadFilesToServer()">Upload</button>
                    </span>
                </div>

            </div>
        </div>
    </div>
    <!-- End Add User Modal -->
</div>

<script src="~/Scripts/jqueryFileTree.js"></script>
<script src="~/jslib/setup/ReportTemplate.js"></script>
<script type="text/javascript">

    $(document).ready(function () {

        $('#fileTreeDemo_2').fileTree({ root: '~/Report/', script: '../../web/jqueryFileTree.aspx', folderEvent: 'click', expandSpeed: 750, collapseSpeed: 750, multiFolder: false }, function (file) {
            selectedFilePath = file;
        }, function (dir) {
            selectedFolderPath = dir;
        });

    });
</script>
